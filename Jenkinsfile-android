@Library('apim-jenkins-lib@master') _

pipeline {
    agent { label 'ng2AgentStable' }
    environment { 
        ARTIFACTORY_CREDS = credentials('ARTIFACTORY_USERNAME_PASSWORD')
        ARTIFACTORY_USER = "$ARTIFACTORY_CREDS_USR"
        ARTIFACTORY_PASSWORD = "$ARTIFACTORY_CREDS_PSW"  
        BRANCH_NAME= 'develop'

    }
    parameters {
        string(name: 'VAR_Branch_Name', defaultValue: 'develop', description: 'Android-MAS-SDK Git repo branch name')
        string(name: 'VAR_MASUNIT_Branch_Name', defaultValue: 'develop', description: 'Android-MAS-Unit Git repo branch name')
        string(name: 'VAR_Emulator_Device_Name', defaultValue: 'device-api29', description: 'Emulator Device Name')
        string(name: 'VAR_ADB', defaultValue: '/Users/qa/Library/Android/sdk/platform-tools/adb', description: 'adb path')
       
    }
    stages {
        stage("Checkout") {
            steps {  
                echo "Checking out to appropriate branch ..."
                script {
                    echo "${env.BRANCH_NAME}"
                    sh 'git checkout ${env.BRANCH_NAME}'
                    sh 'git branch -r'
                    checkout([
                        $class: 'GitSCM', 
                        branches: [[name: '*/develop']],
                        userRemoteConfigs: [[credentialsId:'GITHUB_CAAPIM_TOKEN',url: 'https://github.com/CAAPIM/Android-MAS-SDK.git']]
                     ])
                    sh 'ls'
                    sh 'git branch -a'
                    checkout([
                        $class: 'GitSCM', 
                        branches: [[name: '*/testJenkins']],
                        extensions: [[$class: 'RelativeTargetDirectory',
                            relativeTargetDir: 'MASUnit']],
                        userRemoteConfigs: [[credentialsId:'GITHUB_CAAPIM_TOKEN',url: 'https://github.com/CAAPIM/Android-MAS-Unit.git']]
                     ])
                    sh 'ls'
                    sh 'git branch -a'
                    sh 'cd MASUnit;ls'
                    sh 'cd MASUnit;git branch -a'
                
                }
            }
        }
    }

    post {
    always {
      echo "end"
    }
  }
}

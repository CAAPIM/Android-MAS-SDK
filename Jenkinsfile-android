@Library('apim-jenkins-lib@master') _

pipeline {
    agent { label 'ng2AgentStable' }
    environment { 
        ARTIFACTORY_CREDS = credentials('ARTIFACTORY_USERNAME_PASSWORD')
        ARTIFACTORY_USER = "$ARTIFACTORY_CREDS_USR"
        ARTIFACTORY_PASSWORD = "$ARTIFACTORY_CREDS_PSW"  
    }
    parameters {
        string(name: 'SDK_Branch_Name', defaultValue: 'develop', description: 'Android-MAS-SDK Git repo branch name')
        string(name: 'MASUnit_Branch_Name', defaultValue: 'develop', description: 'Android-MAS-Unit Git repo branch name')
        string(name: 'Emulator_Device_Name', defaultValue: 'device-api29', description: 'Emulator Device Name')
        string(name: 'ADB', defaultValue: '/Users/qa/Library/Android/sdk/platform-tools/adb', description: 'adb path')
       
    }
    stages {
        stage("Checkout") {
            steps {  
                echo "Checking out SDK Branch ..."
                script {
                    checkout([
                        $class: 'GitSCM', 
                        branches: [[name: '*/${SDK_Branch_Name}']],
                        userRemoteConfigs: [[credentialsId:'GITHUB_CAAPIM_TOKEN',url: 'https://github.com/CAAPIM/Android-MAS-SDK.git']]
                     ])
                    echo "Checking out MASUnit Branch ..."
                    checkout([
                        $class: 'GitSCM', 
                        branches: [[name: '*/${MASUNIT_Branch_Name}']],
                        extensions: [[$class: 'RelativeTargetDirectory',
                            relativeTargetDir: 'MASUnit']],
                        userRemoteConfigs: [[credentialsId:'GITHUB_CAAPIM_TOKEN',url: 'https://github.com/CAAPIM/Android-MAS-Unit.git']]
                     ])
                    
                
                }
            }
        }
    }

    post {
    always {
      echo "end"
    }
  }
}
